<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="action_qrcode_card15_backend_server" model="ir.actions.server">
            <field name="name">QRCode Card - 1.5cm</field>
            <field name="model_id" search="[('model', '=', 'informes.encuestas.merge')]"/>
            <field name="binding_model_id" search="[('model', '=', 'informes.encuestas.merge')]"/>
            <field name="binding_view_types">list,form</field>
            <field name="state">code</field>
            <field name="code">
urlbase = env['ir.config_parameter'].sudo().search([('key','=','web.base.url')]).value
if not urlbase:
    raise UserError("No se encontr√≥ la URL base del sistema")

for record in records:
    if record.personas_id:
        url = urlbase + '/web/ultimocertificado/personas/' + str(record.personas_id.id) + '/' + str(record.cliente_id.id if record.cliente_id else 0) + '/print_qr_card15/' + str(record.id)
    else:
        tipo_code = record.xtipodocumento.code if record.xtipodocumento and record.xtipodocumento.code else ''
        maquinaria_id = record.xmaquinaria.id if record.xmaquinaria else 0
        cliente_id = record.cliente_id.id if record.cliente_id else 0
        url = urlbase + '/web/ultimocertificado/' + str(tipo_code) + '/' + str(maquinaria_id) + '/' + str(cliente_id) + '/print_qr_card15'
    
    action = {
        'type': 'ir.actions.act_url',
        'url': url,
        'target': 'new',
    }
            </field>
        </record>
    </data>
</odoo>

