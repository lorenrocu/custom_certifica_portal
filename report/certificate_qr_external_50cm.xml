<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- QR Card - 5.0cm -->
        <template id="certificate_qr_external_50cm_page">
            <t t-set="doc" t-value="doc.with_context({'lang':doc.create_uid.lang})" />
            <t t-set="ruta_url" t-value="doc.xtipodocumento.code or 'equiposdemedicion'" />
            <t t-set="idreg" t-value="(doc.xtipodocumento.code == 'personas') and (doc.personas_id.id or 0) or (doc.xmaquinaria.id or 0)" />
            <t t-set="uid" t-value="doc.cliente_id.id or env.user.id" />
            <t t-set="overlay_js_card_url" t-value="'/web/ultimocertificado/%s/%s/%s/print_qr50/overlay_js_card_50' % (ruta_url, idreg, uid)" />
            <div class="page">
                <h3>Generando certificado con QR Card (Servicio Externo) - 5.0cm</h3>
                <p>Si la descarga no inicia automáticamente, <a t-att-href="overlay_js_card_url">haz clic aquí</a>.</p>
                <script type="text/javascript">window.location = "<t t-esc='overlay_js_card_url'/>";</script>
            </div>
        </template>

        <template id="report_certificate_qr_external_50cm">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="custom_certifica_portal.certificate_qr_external_50cm_page" />
                </t>
            </t>
        </template>

        <report 
            id="print_certificate_qr_external_50cm" 
            menu="True" 
            string="QR Card - 5.0cm" 
            model="informes.encuestas.merge" 
            report_type="qweb-html" 
            file="custom_certifica_portal.report_certificate_qr_external_50cm" 
            name="custom_certifica_portal.report_certificate_qr_external_50cm"
            print_report_name="'Certificado-QR-External-5.0cm - %s' % (object.codigocliente)" />

    </data>
</odoo>